# 1. ูุฑุญูุฉ ุงูุจูุงุก: ูุณุชุฎุฏู ูุณุฎุฉ ุญุฏูุซุฉ ูุฏุนู ุงูููุฏ ุงูุฎุงุต ุจู
# ููููู ุงุณุชุฎุฏุงู golang:alpine ูุถูุงู ุฌูุจ ุฃุญุฏุซ ุฅุตุฏุงุฑ ุฏุงุฆูุงู
FROM golang:alpine AS builder

# ูุญุฏุฏ ูุฌูุฏ ุงูุนูู ุฏุงุฎู ุงูุณูุฑูุฑ
WORKDIR /app

# ููุณุฎ ูููุงุช ุชุนุฑูู ุงูููุชุจุงุช ุฃููุงู (ููุงุณุชูุงุฏุฉ ูู ุงููุงุด ูุชุณุฑูุน ุงูุจูุงุก)
COPY go.mod go.sum ./
RUN go mod download

# ููุณุฎ ุจุงูู ุงูููุฏ
COPY . .

# ูุจูู ุงูุชุทุจูู ููุณููู "dragon-server"
RUN go build -o dragon-server cmd/api/main.go

# ---------------------------------------------------

# 2. ุงููุฑุญูุฉ ุงูููุงุฆูุฉ: ูุดุบู ุงูุชุทุจูู ูู ุญุงููุฉ ุตุบูุฑุฉ ุฌุฏุงู (Alpine)
FROM alpine:latest

# ๐ ูุฐุง ูู ุงูุณุทุฑ ุงูุฌุฏูุฏ ูุงูุฅุฌุจุงุฑู ูุฅุตูุงุญ ูุดููุฉ ุชูููุช ุงูุฑูุงุถ
RUN apk add --no-cache tzdata

WORKDIR /root/

# ููุณุฎ ุงูููู ุงูุชูููุฐู ููุท ูู ูุฑุญูุฉ ุงูุจูุงุก ุงูุณุงุจูุฉ
COPY --from=builder /app/dragon-server .

# ููุชุญ ุงูุจูุฑุช 3000
EXPOSE 3000

# ุฃูุฑ ุงูุชุดุบูู
CMD ["./dragon-server"]